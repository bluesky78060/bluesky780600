<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>🧪 과수농가 농약살포 - 용수 pH 조절 계산기</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans KR", sans-serif;
      line-height: 1.6;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      color: #333;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    
    .header {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      color: white;
      padding: 30px 40px;
      text-align: center;
    }
    
    .header h1 {
      font-size: 2.2em;
      margin-bottom: 10px;
      font-weight: 700;
    }
    
    .header .subtitle {
      font-size: 1.1em;
      opacity: 0.9;
    }
    
    .main-content {
      padding: 40px 60px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 60px;
    }
    
    @media (max-width: 768px) {
      .main-content {
        grid-template-columns: 1fr;
        gap: 30px;
        padding: 30px 20px;
      }
    }
    
    .card {
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(0, 0, 0, 0.05);
    }
    
    .card h2 {
      color: #2c3e50;
      margin-bottom: 20px;
      font-size: 1.4em;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .input-section {
      grid-column: 1 / -1;
    }
    
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }
    
    .form-group {
      display: flex;
      flex-direction: column;
    }
    
    .form-group label {
      font-weight: 600;
      color: #34495e;
      margin-bottom: 8px;
      font-size: 0.95em;
    }
    
    .form-group input,
    .form-group select {
      padding: 12px 15px;
      border: 2px solid #e1e8ed;
      border-radius: 10px;
      font-size: 1em;
      transition: all 0.3s ease;
      background: white;
    }
    
    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #4facfe;
      box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
    }
    
    .form-group input::placeholder {
      color: #95a5a6;
    }
    
    .hint {
      font-size: 0.85em;
      color: #7f8c8d;
      margin-top: 5px;
    }
    
    .acid-settings {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 20px;
      margin-top: 15px;
      border: 2px dashed #dee2e6;
    }
    
    .acid-settings.citric {
      background: #fff3cd;
      border-color: #ffeaa7;
    }
    
    .button-group {
      display: flex;
      gap: 15px;
      margin-top: 25px;
      flex-wrap: wrap;
    }
    
    .btn {
      padding: 12px 25px;
      border: none;
      border-radius: 10px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .btn-secondary {
      background: #95a5a6;
      color: white;
    }
    
    .btn-success {
      background: #27ae60;
      color: white;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    
    .guide-section {
      background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
    }
    
    .guide-item {
      background: rgba(255, 255, 255, 0.9);
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 15px;
      border-left: 4px solid #4facfe;
    }
    
    .guide-item:last-child {
      margin-bottom: 0;
    }
    
    .guide-item h4 {
      color: #2c3e50;
      margin-bottom: 8px;
      font-size: 1.1em;
    }
    
    .guide-item ul {
      list-style: none;
      padding-left: 0;
    }
    
    .guide-item li {
      color: #34495e;
      padding: 3px 0;
      position: relative;
      padding-left: 20px;
    }
    
    .guide-item li::before {
      content: "•";
      color: #4facfe;
      position: absolute;
      left: 0;
      font-weight: bold;
    }
    
    .result-section {
      grid-column: 1 / -1;
      background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
    }
    
    .result-display {
      background: white;
      border-radius: 10px;
      padding: 25px;
      margin: 20px 0;
      border: 2px solid #e1e8ed;
      font-family: 'Courier New', monospace;
      white-space: pre-wrap;
      min-height: 200px;
      color: #2c3e50;
      line-height: 1.8;
    }
    
    .warning-box {
      background: #fff3cd;
      border: 2px solid #ffeaa7;
      border-radius: 10px;
      padding: 20px;
      margin: 20px 0;
      color: #856404;
    }
    
    .warning-box h4 {
      margin-bottom: 10px;
      color: #d63031;
    }
    
    .tips-section {
      grid-column: 1 / -1;
      background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
    }
    
    .tips-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }
    
    .tip-item {
      background: rgba(255, 255, 255, 0.9);
      padding: 20px;
      border-radius: 10px;
      border-left: 4px solid #00b894;
    }
    
    .tip-item h4 {
      color: #2c3e50;
      margin-bottom: 10px;
    }
    
    .tip-item ul {
      list-style: none;
      padding-left: 0;
    }
    
    .tip-item li {
      padding: 5px 0;
      color: #34495e;
      position: relative;
      padding-left: 20px;
    }
    
    .tip-item li::before {
      content: "✓";
      color: #00b894;
      position: absolute;
      left: 0;
      font-weight: bold;
    }
    

  </style>
</head>
<body>
  <div class="container">
    <!-- 헤더 -->
    <div class="header">
      <h1>🧪 과수농가 농약살포 - 용수 pH 조절 계산기</h1>
      <p class="subtitle">대부분의 농약은 약산성(pH 5.0~6.5)에서 안정/효율이 좋습니다. 구리제제는 과산성 피하고(약알칼리~중성), 글리포세이트는 산성(pH 4.5~5.5)에서 유리합니다.</p>
    </div>

    <div class="main-content">
      <!-- 입력 섹션 -->
      <div class="card input-section">
        <h2>📝 입력 정보</h2>
        
        <div class="form-grid">
          <div class="form-group">
            <label for="vol">물의 부피 (L)</label>
            <input id="vol" type="number" min="0" step="0.1" value="100" placeholder="예: 100" />
          </div>
          
          <div class="form-group">
            <label for="alk">알칼리도 (mg/L as CaCO₃)</label>
            <input id="alk" type="number" min="0" step="1" value="100" placeholder="예: 100" />
            <div class="hint">모르면 0으로 입력하세요</div>
          </div>
          
          <div class="form-group">
            <label for="ph0">초기 pH</label>
            <input id="ph0" type="number" min="0" max="14" step="0.1" value="8.0" />
          </div>
          
          <div class="form-group">
            <label for="pht">목표 pH</label>
            <input id="pht" type="number" min="0" max="14" step="0.1" value="6.0" />
          </div>
        </div>

        <div class="form-group">
          <label for="acid">산도 조절제</label>
          <select id="acid">
            <option value="acetic">빙초산(아세트산, 액상)</option>
            <option value="citric">구연산(무수·분말)</option>
          </select>
        </div>

        <div id="aceticBox" class="acid-settings">
          <div class="form-grid">
            <div class="form-group">
              <label for="purity">빙초산 순도 (%)</label>
              <input id="purity" type="number" min="10" max="100" step="0.1" value="99" />
            </div>
            <div class="form-group">
              <label for="density">밀도 (g/mL)</label>
              <input id="density" type="number" min="0.8" max="1.2" step="0.001" value="1.049" />
            </div>
          </div>
          <div class="hint">기본값: 99%, 1.049 g/mL (20℃)</div>
        </div>

        <div id="citricInfo" class="acid-settings citric" style="display: none;">
          <p><strong>💡 구연산 정보:</strong> 구연산은 삼염기성 산으로 계산상 <strong>H⁺ 3개 제공</strong>으로 환산(보수적)합니다.</p>
        </div>

        <div class="button-group">
          <button class="btn btn-primary" onclick="calc()">🧮 계산하기</button>
          <button class="btn btn-secondary" onclick="resetForm()">🔄 입력 초기화</button>
        </div>
      </div>

      <!-- 권장 pH 가이드 -->
      <div class="card guide-section" style="min-width: 450px;">
        <h2>📋 권장 pH 가이드</h2>
        
        <div class="guide-item">
          <h4>🦠 살균제</h4>
          <ul>
            <li>유기계: pH 5.0~6.5</li>
            <li>구리제제: pH 7.0~8.0</li>
          </ul>
        </div>
        
        <div class="guide-item">
          <h4>🐛 살충제</h4>
          <ul>
            <li>유기인계/카바메이트: pH 5.0~6.0 (알칼리 분해 주의)</li>
            <li>피레스로이드계: pH 5.5~6.5</li>
          </ul>
        </div>
        
        <div class="guide-item">
          <h4>🌿 제초제</h4>
          <ul>
            <li>글리포세이트: pH 4.5~5.5 (산성에서 유리)</li>
            <li>다수 약제: pH 5.5~6.5 권장</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- 결과 섹션 -->
    <div class="card result-section">
      <h2>📊 계산 결과</h2>
      <div id="result" class="result-display">계산 버튼을 클릭하여 필요한 산의 양을 계산하세요.</div>
      
      <div class="button-group">
        <button class="btn btn-success" onclick="copyResult()">📋 결과 복사</button>
        <button class="btn btn-secondary" onclick="saveAsTxt()">💾 TXT로 저장</button>
      </div>
      

    </div>

    <!-- 혼합 팁 섹션 -->
    <div class="card tips-section">
      <h2>💡 혼합 가이드 & 현장 팁</h2>
      
      <div class="tips-grid">
        <div class="tip-item">
          <h4>🔬 혼합 순서</h4>
          <ul>
            <li>탱크에 물 70% 채움</li>
            <li>산도 조절제로 pH 맞춤</li>
            <li>농약 투입(라벨 순서 준수)</li>
            <li>최종 보정</li>
          </ul>
        </div>
        
        <div class="tip-item">
          <h4>⚗️ 화학적 주의사항</h4>
          <ul>
            <li>경도 이온(Ca²⁺/Mg²⁺) 많으면 글리포세이트 등 약효 저하</li>
            <li>필요 시 AMS/킬레이트 사용</li>
            <li>구리제제는 과산성에서 약해 가능 (pH 7~8 유지)</li>
          </ul>
        </div>
        
        <div class="tip-item">
          <h4>🌡️ 현장 관리</h4>
          <ul>
            <li>혼용은 제품 라벨 우선</li>
            <li>침전·층분리·발열·거품 여부를 소량 테스트로 확인</li>
            <li>살포 직전 혼합, 장시간 보관 금지</li>
            <li>온도 20-25℃에서 최적 효과</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <script>
    // 상수들
    const KA_ACETIC = 1.8e-5;
    const PKA = -Math.log10(KA_ACETIC);
    const MW_ACETIC = 60.052;
    const MW_CITRIC = 192.124;
    const ALK_END_PH = 4.5;

    // 유틸리티 함수들
    function clamp(x, a, b) { 
      return Math.max(a, Math.min(b, x)); 
    }
    
    function fmt(x, d = 4) { 
      return (isFinite(x) ? Number(x).toFixed(d) : ''); 
    }
    
    function nowStr() { 
      const t = new Date(); 
      const p = n => String(n).padStart(2, '0'); 
      return `${t.getFullYear()}-${p(t.getMonth() + 1)}-${p(t.getDate())} ${p(t.getHours())}:${p(t.getMinutes())}`; 
    }

    // UI 다이나믹스: 산도 조절제 변경
    document.getElementById('acid').addEventListener('change', () => {
      const ac = document.getElementById('acid').value;
      const aceticBox = document.getElementById('aceticBox');
      const citricInfo = document.getElementById('citricInfo');
      
      if (ac === 'acetic') {
        aceticBox.style.display = 'block';
        citricInfo.style.display = 'none';
      } else {
        aceticBox.style.display = 'none';
        citricInfo.style.display = 'block';
      }
    });

    function resetForm() {
      document.getElementById('vol').value = 100;
      document.getElementById('alk').value = 100;
      document.getElementById('ph0').value = 8.0;
      document.getElementById('pht').value = 6.0;
      document.getElementById('acid').value = 'acetic';
      document.getElementById('purity').value = 99;
      document.getElementById('density').value = 1.049;
      document.getElementById('aceticBox').style.display = 'block';
      document.getElementById('citricInfo').style.display = 'none';
      document.getElementById('result').textContent = '계산 버튼을 클릭하여 필요한 산의 양을 계산하세요.';
    }

    function calc() {
      const V = parseFloat(document.getElementById('vol').value || '0');
      const alk_mgL = parseFloat(document.getElementById('alk').value || '0');
      const pH0 = parseFloat(document.getElementById('ph0').value || '0');
      const pHt = parseFloat(document.getElementById('pht').value || '0');
      const acid = document.getElementById('acid').value;
      const purity = parseFloat(document.getElementById('purity').value || '99');
      const density = parseFloat(document.getElementById('density').value || '1.049');
      
      const out = document.getElementById('result');

      // 입력값 검증
      if (!(V > 0)) {
        out.textContent = '❌ 물의 부피를 입력하세요.';
        return;
      }
      if (!(pH0 >= 0 && pH0 <= 14 && pHt >= 0 && pHt <= 14)) {
        out.textContent = '❌ pH는 0~14 범위여야 합니다.';
        return;
      }
      if (!(purity > 0 && density > 0)) {
        out.textContent = '❌ 순도/밀도를 확인하세요.';
        return;
      }

      // 계산
      const oh_molar = (pH0 > 7) ? Math.pow(10, -(14 - pH0)) : 0.0;
      const n_oh = oh_molar * V;
      const n_alk = V * (alk_mgL / 50000.0);

      let f;
      if (pH0 === ALK_END_PH) {
        f = (pHt <= pH0) ? 1.0 : 0.0;
      } else {
        f = clamp((pH0 - pHt) / (pH0 - ALK_END_PH), 0, 1);
      }

      const r = Math.pow(10, (pHt - PKA));

      let n_acid;
      if (pH0 <= pHt) {
        n_acid = n_alk * f;
      } else {
        n_acid = n_oh * (1 + Math.pow(10, -(pHt - PKA))) + n_alk * f;
      }

      let line1 = '';
      let line2 = '';
      
      if (acid === 'acetic') {
        const Cstock = (purity / 100.0 * density * 1000.0) / MW_ACETIC;
        const vol_mL = (n_acid / Cstock) * 1000.0;
        line1 = `🧪 필요 빙초산: ${fmt(vol_mL, 2)} mL`;
        line2 = `용액 농도: ${fmt(Cstock, 3)} mol/L`;
      } else {
        const grams = (n_acid / 3.0) * MW_CITRIC;
        line1 = `🧪 필요 구연산(분말): ${fmt(grams, 2)} g`;
        line2 = '삼염기성으로 환산(3 당량 산 제공 가정)';
      }

      const ph_est = (n_acid > 0) ? (PKA + Math.log10(r)) : ((pH0 <= pHt) ? pH0 : pHt);

      const result = `
🧪 필요 ${line1.replace('🧪 필요 ', '')}
📈 혼합 후 예상 pH: ${fmt(ph_est, 2)}

ℹ️  ${line2}

📋 입력 조건:
• 물의 부피: ${V} L
• 초기 pH: ${pH0} → 목표 pH: ${pHt}
• 알칼리도: ${alk_mgL} mg/L as CaCO₃

🔬 계산 세부사항:
• 초기 [OH⁻]: ${fmt(oh_molar, 6)} mol/L
• OH⁻ 총 몰수: ${fmt(n_oh, 6)} mol  
• 알칼리도 당량: ${fmt(n_alk, 6)} mol
• 중화 분율: ${fmt(f, 3)}
• 필요 산 총량: ${fmt(n_acid, 6)} mol

⚠️ 중요 주의사항:
반드시 10L 소량 테스트로 확인 후 비례 확대하세요!

🔬 혼합 가이드:
1️⃣ 탱크에 물 70% 채움
2️⃣ 산도조절제 투입 및 pH 조정  
3️⃣ 농약 투입 (제품 라벨 순서 준수)
4️⃣ 최종 pH 보정 및 확인

💡 현장 팁:
• 구리제제: 과산성 피해 (pH 7~8 유지)
• 경도 높은 물: 킬레이트제(AMS) 고려
• 살포 직전 혼합, 장시간 보관 금지
`;

      out.textContent = result;
      
      // pH에 따른 색상 변경
      if (ph_est < 4.0) {
        out.style.background = '#fef2f2';
        out.style.borderColor = '#fca5a5';
      } else if (ph_est > 8.5) {
        out.style.background = '#eff6ff';
        out.style.borderColor = '#93c5fd';
      } else {
        out.style.background = 'white';
        out.style.borderColor = '#e1e8ed';
      }
    }

    function copyResult() {
      const text = document.getElementById('result').textContent;
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).then(
          () => alert('✅ 결과를 클립보드에 복사했습니다.'),
          () => alert('❌ 복사 권한이 거부되었습니다. 수동으로 복사해 주세요.')
        );
      } else {
        // Fallback
        const ta = document.createElement('textarea');
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        try {
          document.execCommand('copy');
          alert('✅ 결과를 클립보드에 복사했습니다.');
        } catch (e) {
          alert('❌ 복사 실패. 수동 복사해 주세요.');
        }
        ta.remove();
      }
    }

    function saveAsTxt() {
      const text = document.getElementById('result').textContent;
      const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `농약살포_pH_계산_결과_${nowStr().replace(/[:\s]/g, '_')}.txt`;
      document.body.appendChild(a);
      a.click();
      a.remove();
    }

    // 페이지 로드 시 초기화
    document.addEventListener('DOMContentLoaded', function() {
      resetForm();
    });
  </script>
</body>
</html>